<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>가계부 관리 | FinFit</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .summary-card { border-radius: 12px; background-color: #f8f9fa; padding: 20px; }
        .summary-title { font-size: 1rem; color: #6c757d; }
        .summary-value { font-size: 1.5rem; font-weight: bold; }
        .ie-card { border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
        .ie-buttons button { margin-left: 5px; }
        .form-card { border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
    </style>
</head>
<body>
<nav th:replace="~{navbar :: navbarFragment}"></nav>

<div class="container mt-5">
    <h1 class="mb-4 fw-bold text-center">가계부 관리</h1>

	<!-- 월별 요약 -->
	<div class="row text-center mb-4">
	    <div class="col-md-4 mb-3">
	        <div class="summary-card">
	            <div class="summary-title">총 수입</div>
	            <div class="summary-value text-primary"
	                 th:text="${#numbers.formatDecimal(summary.income,0,'COMMA',2,'POINT')}">0</div>
	        </div>
	    </div>
	    <div class="col-md-4 mb-3">
	        <div class="summary-card">
	            <div class="summary-title">총 지출</div>
	            <div class="summary-value text-danger"
	                 th:text="${#numbers.formatDecimal(summary.expense,0,'COMMA',2,'POINT')}">0</div>
	        </div>
	    </div>
	    <div class="col-md-4 mb-3">
	        <div class="summary-card">
	            <div class="summary-title">잔액</div>
	            <div class="summary-value"
	                 th:text="${#numbers.formatDecimal(summary.balance,0,'COMMA',2,'POINT')}">0</div>
	        </div>
	    </div>
	</div>

    <!-- 가계부 입력 폼 -->
    <div class="card form-card mb-4 p-4">
        <h4 class="mb-3 fw-semibold">새 내역 추가</h4>
        <form th:action="@{/incomeexpense/save}" method="post">
            <div class="row g-3">
                <div class="col-md-3">
                    <label for="type" class="form-label">타입</label>
                    <select id="type" name="type" class="form-select" required>
                        <option value="INCOME">수입</option>
                        <option value="EXPENSE">지출</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="category" class="form-label">카테고리</label>
                    <input type="text" id="category" name="category" class="form-control"
                           placeholder="카테고리 입력" required>
                </div>
                <div class="col-md-3">
                    <label for="amount" class="form-label">금액</label>
                    <input type="number" id="amount" name="amount" class="form-control"
                           placeholder="금액 입력" step="0.01" required>
                </div>
                <div class="col-md-3">
                    <label for="date" class="form-label">날짜</label>
                    <input type="date" id="date" name="date" class="form-control" required>
                </div>
                <div class="col-md-12">
                    <label for="description" class="form-label">설명</label>
                    <input type="text" id="description" name="description" class="form-control"
                           placeholder="설명 입력">
                </div>
            </div>
            <button type="submit" class="btn btn-primary mt-3 w-100">저장</button>
        </form>
    </div>

    <!-- 필터 -->
    <div class="card form-card mb-4 p-3">
        <form th:action="@{/incomeexpense/filter}" method="get" class="row g-3 align-items-end">
            <div class="col-md-4">
                <label class="form-label">카테고리</label>
                <input type="text" name="category" class="form-control" placeholder="카테고리 필터">
            </div>
            <div class="col-md-4">
                <label class="form-label">년도</label>
                <input type="number" name="year" class="form-control" placeholder="YYYY">
            </div>
            <div class="col-md-4">
                <label class="form-label">월</label>
                <input type="number" name="month" class="form-control" placeholder="MM">
            </div>
            <div class="col-md-12">
                <button type="submit" class="btn btn-secondary w-100 mt-2">필터 적용</button>
                <a th:href="@{/incomeexpense}" class="btn btn-outline-secondary w-100 mt-2">전체 조회</a>
            </div>
        </form>
    </div>

    <!-- 가계부 목록 -->
    <h4 class="mb-3 fw-bold">가계부 내역</h4>
    <div class="row g-3">
        <div class="col-md-4 mb-3" th:each="ie : ${incomeExpenses}">
            <div class="card ie-card p-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="fw-semibold mb-1" th:text="${ie.category}">카테고리</div>
                        <div>
                            타입:
                            <span th:text="${ie.type}"
                                  th:classappend="(${ie.type} == 'INCOME') ? ' text-primary fw-bold' : ' text-danger fw-bold'">
                            </span>
                        </div>
                        <div>
                            금액:
                            <span th:text="${#numbers.formatDecimal(ie.amount,0,'COMMA',2,'POINT')}"></span>
                        </div>
                        <div>날짜: <span th:text="${ie.date}"></span></div>
                        <div th:if="${ie.description != null}">설명: <span th:text="${ie.description}"></span></div>
	                    </div>
	                    <div class="ie-buttons d-flex flex-column">
	                        <button class="btn btn-sm btn-warning mb-2"
	                                data-bs-toggle="modal"
	                                th:data-bs-target="${'#editModal' + ie.id}">수정</button>
	                        <form th:action="@{/incomeexpense/delete}" method="post" th:object="${ie}"
	                              onsubmit="return confirm('정말 삭제하시겠습니까?');">
	                            <input type="hidden" name="id" th:value="${ie.id}" />
	                            <button type="submit" class="btn btn-sm btn-danger">삭제</button>
	                        </form>
	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>

	<!-- 모달: 수정 -->
	<div th:each="ie : ${incomeExpenses}" th:id="${'editModal' + ie.id}" class="modal fade" tabindex="-1" aria-hidden="true">
	    <div class="modal-dialog">
	        <div class="modal-content p-3">
	            <form th:action="@{/incomeexpense/update}" method="post">
	                <input type="hidden" name="id" th:value="${ie.id}" />
	                <div class="mb-3">
	                    <label class="form-label">타입</label>
	                    <select name="type" class="form-select" required>
	                        <option th:selected="${ie.type == 'INCOME'}" value="INCOME">수입</option>
	                        <option th:selected="${ie.type == 'EXPENSE'}" value="EXPENSE">지출</option>
	                    </select>
	                </div>
	                <div class="mb-3">
	                    <label class="form-label">카테고리</label>
	                    <input type="text" name="category" class="form-control" th:value="${ie.category}" required>
	                </div>
	                <div class="mb-3">
	                    <label class="form-label">금액</label>
	                    <input type="number" name="amount" class="form-control"
	                           th:value="${ie.amount}" step="0.01" required>
	                </div>
	                <div class="mb-3">
	                    <label class="form-label">날짜</label>
	                    <input type="date" name="date" class="form-control" th:value="${ie.date}" required>
	                </div>
	                <div class="mb-3">
	                    <label class="form-label">설명</label>
	                    <input type="text" name="description" class="form-control" th:value="${ie.description}">
	                </div>
	                <button type="submit" class="btn btn-primary w-100">수정 저장</button>
	            </form>
	        </div>
	    </div>
	</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
